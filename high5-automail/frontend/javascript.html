<script>
    // Global vars 
    var Automail = {};
    Automail.currentForm = {};
    Automail.currentForm.fetched = false;
    Automail.currentForm.formUrl = "";
    Automail.currentForm.hasTrigger = false;
    Automail.currentForm.trigger = {};
    Automail.currentForm.trigger.triggerId = "";
    Automail.currentForm.trigger.destinationId = "";
    Automail.currentForm.trigger.recipients = "";
    Automail.currentForm.trigger.alias = "";
    Automail.currentForm.trigger.ccRecipients = "";
    Automail.currentForm.trigger.bccRecipients = "";
    Automail.currentForm.trigger.draftId = "";
</script>

<script>
    function requestForm() {
        let formUrl = $("#formUrl").val().trim();
        if (formUrl.length == 0 && formUrl.indexOf("edit") < 0) {
            return;
        } else {
            google.script.run.withSuccessHandler(receiveForm).openByUrl(formId);
        }
    }

    function receiveForm(formObj) {
        console.log(formObj);
        Object.assign(Automail.currentForm, formObj);
        Automail.currentForm.fetched = true;
        if(Automail.currentForm.hasTrigger){
            $("#recipients").val(Automail.currentForm.trigger.recipients);
            $("#alias").val(Automail.currentForm.trigger.alias);
            $("#customName").val(Automail.currentForm.trigger.customName);
            $("#ccRecipients").val(Automail.currentForm.trigger.ccRecipients);
            $("#bccRecipients").val(Automail.currentForm.trigger.bccRecipients);
            $("#draftId").val(Automail.currentForm.trigger.draftId);
        }
    }
</script>

<!-- setFormAutoMail -->
<script>
    function setFormAutoMail() {
        var params = {}; //same type as currentForm
        params.trigger = {};
        params.mode = "create";
        
        if (Automail.currentForm.hasTrigger){
            params.mode = "update";
        }
        params.formUrl = $("#formUrl").val();
        params.trigger.recipients = $("#recipients").val();
        params.trigger.alias = $("#alias").val();
        params.trigger.customName = $("#customName").val();
        params.trigger.ccRecipients = $("#ccRecipients").val();
        params.trigger.bccRecipients = $("#bccRecipients").val();
        params.trigger.draftId = $("#draftId").val();

        //todo
    }
</script>

<!-- document.ready  -->
<script>
    $(function () {
        //get draft buttons
        $('#emailDraftRefresh').hover(
            function () { $(this).addClass('fa-spin') },
            function () { $(this).removeClass('fa-spin') }
        ).click(e => {
            google.script.run
                .withSuccessHandler(tags => {
                    $("#draftId")
                        .html(tags)
                        .fadeOut(100)
                        .fadeIn(100);
                    $("#emailDraftRefresh").removeClass("fa-spin");
                })
                .generateDraftsOptionTags();
        });

        $("#menuButton").click(function () {
            var x = $("#myTopnav");
            if (x.hasClass("responsive")) {
                x.removeClass("responsive");
            } else {
                x.addClass("responsive");
            }
        });

        $("#btnGetForm").click(requestForm());
        $("#btnSubmit").click(setFormAutomail());
    })
</script>